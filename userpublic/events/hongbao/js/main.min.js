function tempRender(e,t){return t&&$.each(t,function(t,n){var a=new RegExp("#"+t+"#","ig");e=e.replace(a,n)}),e}function formatMoney(e){var e=Number(e),t=/(-?\d+)(\d{3})/;for(e=Number.prototype.toFixed?e.toFixed(2):Math.round(100*e)/100,e=""+e;t.test(e);)e=e.replace(t,"$1,$2");return e}function createRecords(e){var t="",n=count=0;$.each(e,function(e,a){t+="<tr>",t+="<td>"+a.date+"</td>",t+="<td>"+a.tasktime+"</td>",t+="<td>"+formatMoney(a.recharge)+"</td>",t+="<td>"+formatMoney(a.bet)+"</td>",t+="<td>"+formatMoney(a.hongbao)+"</td>",t+="</tr>",n++,count+=1e5*a.hongbao}),t&&n||(t='<tr><td colspan="6" style="text-align:center;line-height:60px;">呦～大爷，您第一次来啊！赶快去开启今日任务吧，以免红包与您擦肩而过哦～</td></tr>'),$("#J-table").html(t),$("#J-times").html(n),$("#J-hongbao").html(formatMoney(count/1e5))}function countdown(e,t){t=new Date(t),e=new Date(e);var n=t-e;return n>0?(n/=1e3,h=Math.floor(n/3600),m=Math.floor(n%3600/60),s=n%60,[h,m,s]):[]}$(function(){var e=function(e,t){$(t.elem).text(formatMoney(e))};$(".J-prize").animateNumber({number:poolMoney,numberStep:e},2e3);var t=$("#J-temp-cont"),n=$(".check-record a");if(eventIsEnd)t.html(tempRender($(".J-temp-step4").html())),n.text("活动已结束").prop("data-action","").addClass("disabled");else if(taskIsOpen)if(rechargeMoney<=0)t.html(tempRender($(".J-temp-step2").html())),n.text("已开启今日活动").prop("data-action","").addClass("disabled");else{n.text("已开启今日活动").prop("data-action","").addClass("disabled");var a=betMoney||0;multiple=Math.floor(a/rechargeMoney),width=multiple/48,need=0,get=0,isMax=!1,width=width>1?"100%":100*width+"%",$.each(multipleBack,function(e,t){return multiple<parseInt(e)?(need=rechargeMoney*(e-multiple),get=t*rechargeMoney,isMax=!1):void 0});var o={rechargeMoney:formatMoney(rechargeMoney),amount:formatMoney(a),multiple:multiple,need:formatMoney(need),get:formatMoney(get)};t.html(tempRender($(".J-temp-step3").html(),o)),t.find("#J-progress-bar").animate({width:width},1200),multiple>=48?t.find(".J-task-finished").show():t.find(".J-task-goon").show()}else t.html(tempRender($(".J-temp-step1").html()));createRecords(eventRecords||{});var r=$(".overlay").fadeOut(0),d=$(".dialog").fadeOut(0),i=$("#record"),l=$("#event-board");$("body").on("click",'[data-dialog="record"]',function(e){e.preventDefault(),r.fadeIn(),i.fadeIn()}),d.find('[data-action="close"]').on("click",function(e){e.preventDefault(),r.fadeOut(),$(this).parents(".dialog:eq(0)").fadeOut()}),t.on("click",'[data-action="task-open"]',function(e){e.preventDefault();var t=countdown(currentTime,eventStart);return t.length?alert("活动暂未开启，开启时间2015年6月8日0时"):void c()}),$(".check-record").on("click",'[data-action="task-open"]',function(e){e.preventDefault();var t=countdown(currentTime,eventStart);return t.length?alert("活动暂未开启，开启时间2015年6月8日0时"):void c()});var c=function(){$.ajax({type:"GET",url:signUrl,success:function(e){"error"==e.msgType?alert(e.msg):(r.fadeIn(),l.fadeIn(),n.text("已开启今日活动").prop("data-action","").addClass("disabled"),t.html(tempRender($(".J-temp-step2").html())))}})}});