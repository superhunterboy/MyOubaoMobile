!function(e,t,o,s){var i={cls:"",valueKey:"value",textKey:"text",isInput:!1,isCounter:!1,min:1,max:99999,step:1,realDom:"",zIndex:100,isScroll:!0,scrollHeight:310,scrollDis:31,tpl:'<div class="choose-model"><div class="choose-list"><div class="choose-list-cont"><#=loopItems#></div></div><span class="choose-scroll" onselectstart="return false;"></span><span class="info"><input data-realvalue="<#=value#>" class="choose-input choose-input-disabled" disabled="disabled" type="text" value="<#=text#>" /></span><i></i></div>',itemTpl:'<a data-value="<#=value#>" href="#"><#=text#></a>'},l={init:function(e){var t=this;t.opts=e,t.realDom=s(e.realDom),t.realDom.hide(),t.dom=null,t.listDom=null,t.buildSelect(),e.isCounter&&(t.$ctrlDecrease=s('<span class="select-counter-action counter-decrease" data-counter-action="decrease">Ôºç</span>'),t.$ctrlIncrease=s('<span class="select-counter-action counter-increase" data-counter-action="increase">+</span>'),t.dom.before(t.$ctrlDecrease).after(t.$ctrlIncrease),t.$ctrl=t.$ctrlDecrease.add(t.$ctrlIncrease),t.setMinValue(e.min),t.setMaxValue(e.max),t.counterEvent(e)),t.initEvent()},show:function(){this.dom.show()},hide:function(){this.dom.hide()},showScroll:function(){var e=this;e.isScrollAble&&this.getScrollDom().show()},hideScroll:function(){var e=this,t=e.getScrollDom();t.hide(),e.isScrollAble&&(e.scrollSetTop(0),t.css("top",0))},getScrollDom:function(){var e=this;return e.scrollDom||(e.scrollDom=e.dom.find(".choose-scroll"))},initScroll:function(){var e=this,t=e.defConfig;e.getListContDomHeight()>t.scrollHeight?(e.isScrollAble=!0,e.getListDom().css({height:t.scrollHeight,overflow:"hidden"}),e.reBuildScroll()):e.isScrollAble=!1},reBuildScroll:function(){var e=this,t=e.defConfig,o=t.scrollHeight,s=e.getListContDomHeight();e.scrollBl=s/o,e.getScrollDom().css("height",o/e.scrollBl),e.scrollMin=0},scrollSetTop:function(e){var t=this;t.getListDom().scrollTop(e*t.scrollBl)},getListDom:function(){var e=this;return e.listDom||(e.listDom=e.dom.find(".choose-list"))},getListContDom:function(){var e=this;return e.listContDom||(e.listContDom=e.dom.find(".choose-list-cont"))},getListContDomHeight:function(){var e=this,t=0;return e.getListDom().css({visibility:"hidden"}).show(),t=e.getListContDom().height(),e.getListDom().css({visibility:"visible"}).hide(),t},buildSelect:function(){for(var e=this,t=e.defConfig,o=t.tpl,i=t.itemTpl,l=e.getRealDom().options,n=l.length,a=0,r=[],c="",u="";n>a;a++)r[a]=i.replace(/<#=value#>/g,l[a].value).replace(/<#=text#>/g,l[a].text),a==e.getRealDom().selectedIndex&&(c=l[a].value,u=l[a].text);o=o.replace(/<#=text#>/g,u).replace(/<#=loopItems#>/g,r.join("")),e.dom=s(o),e.dom.addClass(t.cls),e.dom.insertBefore(e.getRealDom()),t.isScroll&&e.initScroll(),t.isInput&&(e.getInput().removeAttr("disabled"),e.getInput().removeClass("choose-input-disabled"),e.inputEvent()),e.setValue(c),e.reSetListWidth()},reSetListWidth:function(){var t=this,o=0;e.util.isIE6&&(o=t.dom.width()+8,t.getListDom().width(o))},reBuildSelect:function(e){var t,o=this,i=o.defConfig,l=s(o.getRealDom()),n=[],a=[],r=o.defConfig.itemTpl;s.each(e,function(e){n[e]='<option value="'+this[i.valueKey]+'">'+this[i.textKey]+"</option>",a[e]=r.replace(/<#=value#>/g,this[i.valueKey]).replace(/<#=text#>/g,this[i.textKey]),this.checked&&(t=e)}),l.html(n.join("")),o.getListContDom().html(a.join("")),"undefined"!=typeof t&&o.setValue(e[t][i.valueKey]),o.defConfig.isScroll&&o.initScroll()},initEvent:function(){var e=this,t=e.defConfig.scrollDis;s(document).mousedown(function(t){var o=t.target;s.contains(e.dom.get(0),o)||(e.getListDom().hide(),e.hideScroll(),e.dom.css("zIndex",""),e.dom.find(".open").removeClass("open"))}),s(window).blur(function(){e.getListDom().hide(),e.dom.css("zIndex",""),e.dom.find(".open").removeClass("open"),e.hideScroll()}),e.dom.click(function(t){var o=t.target,i=o.getAttribute("data-value");null!=i&&e.setValue(i),"none"!=s.trim(e.getListDom().css("display").toLowerCase())?(e.dom.css("zIndex",""),e.getListDom().hide(),e.hideScroll(),e.dom.find(".open").removeClass("open")):(e.dom.css("zIndex",e.defConfig.zIndex),e.getListDom().show(),e.showScroll(),e.dom.find("i").addClass("open")),t.preventDefault()});var i=0;e.getListDom().mousewheel(function(o,s){i+=5*s,o.preventDefault(),clearTimeout(e.timer),e.timer=setTimeout(function(){{var o=e.getListDom(),s=o.scrollTop();parseInt(e.getScrollDom().css("top"))}newTop=s+i*t*-1,scrollTop=0,contHeight=e.getListContDom().height(),maxScroll=o.height()-e.getScrollDom().outerHeight()-4,i=0,o.stop().animate({scrollTop:newTop},500,"easeOutQuad"),scrollTop=newTop/e.scrollBl,scrollTop=0>scrollTop?0:scrollTop,scrollTop=scrollTop>maxScroll?maxScroll:scrollTop,e.scrollDom.stop().animate({top:scrollTop},400,"easeOutQuad")},10)});var l,n=e.getScrollDom(),a=!1,r=function(e){a=!0,l=e.clientY-parseInt(n.css("top")),n.get(0).setCapture?n.get(0).setCapture():window.captureEvents&&window.captureEvents(o.MOUSEMOVE|o.MOUSEUP),s(document).bind("mousemove",c),s(document).bind("mouseup",u)},c=function(t){var o=t.clientY-l,s=0;return t.preventDefault(),a?(s=e.getListDom().height()-n.height()-4,o=0>o?0:o,o=o>s?s:o,n.css("top",o),o=o==s?100*o:o,void e.scrollSetTop(o)):!1},u=function(){n.get(0).releaseCapture?n.get(0).releaseCapture():window.captureEvents&&window.captureEvents(o.MOUSEMOVE|o.MOUSEUP),a=!1,s(document).unbind("mousemove",c),s(document).unbind("mouseup",u)};n.mousedown(r),n.click(function(e){e.preventDefault(),e.stopPropagation()})},getInput:function(){var e=this;return e.input||(e.input=e.dom.find(".choose-input"))},inputEvent:function(){},getRealDom:function(){return this.realDom.get(0)},getItemList:function(){var e=this;return e.getListContDom().children()},setValue:function(e,t){for(var o=this,s=o.getRealDom(),i=(s.selectedIndex,s.options),l=i.length,n=0,a="";l>n;n++)e==i[n].value?(i[n].selected=!0,a=i[n].text):i[n].selected=!1;e=""+e,o.getInput().attr("data-realvalue",e),a=""==a?e:a,o.getInput().val(a),t||o.fireEvent("change",e,a),o.getItemList().removeClass("choose-item-current").parent().find('[data-value="'+e+'"]').addClass("choose-item-current"),o.opts.isCounter&&o.checkCtrl()},getValue:function(){var e=this,t=e.getRealDom(),o=t.selectedIndex;return e.defConfig.isInput?e.getInput().attr("data-realvalue"):t.options[o].value},getText:function(){var e=this.getRealDom(),t=e.selectedIndex;return e.options[t].text},setMinValue:function(e){this.minValue=e,this.checkCtrl()},getMinValue:function(){return this.minValue},setMaxValue:function(e){this.maxValue=e,this.checkCtrl()},getMaxValue:function(){return this.maxValue},setButtonStatus:function(e,t){if(this.$ctrl){var o=this.$ctrl.filter('[data-counter-action="'+e+'"]');"disabled"==t?o.addClass("disabled"):o.removeClass("disabled")}},checkCtrl:function(){var e=this,t=e.getValue();return t<=e.getMinValue()?(e.setButtonStatus("decrease","disabled"),t=e.getMinValue()):e.setButtonStatus("decrease"),t>=e.getMaxValue()?(e.setButtonStatus("increase","disabled"),t=e.getMaxValue()):e.setButtonStatus("increase"),t},counterEvent:function(){var e=this,t=e.opts;e.$ctrl.on("click",function(){if(s(this).hasClass("disabled"))return!1;var o=parseInt(e.getValue()),i=s(this).data("counter-action");"increase"==i?o+=t.step:"decrease"==i&&(o-=t.step),e.setValue(o)})}},n=e.Class(l,o);n.defConfig=i,e[t]=n}(dsgame,"Select",dsgame.Event,jQuery);