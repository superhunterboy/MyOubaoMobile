!function(e,t,a){var r,n={mainPanel:"#J-trace-panel",advancedTypeHas:["fanbei","yingli","yinglilv"],defaultType:"tongbei",dataRowHeader:'<tr><th style="width:125px;" class="text-center">序号</th><th><input data-action="checkedAll" type="checkbox"  checked="checked"/> 追号期次</th><th>倍数</th><th>金额</th><th>预计开奖时间</th></tr>',dataRowTemplate:'<tr><td class="text-center"><#=No#></td><td><input data-action="checkedRow" class="trace-row-checked" type="checkbox" checked="checked"> <span class="trace-row-number"><#=traceNumber#></span></td><td><input class="trace-row-multiple input" value="<#=multiple#>" type="text" style="width:30px;text-align:center;"> 倍</td><td>&yen; <span class="trace-row-money"><#=money#></span> 元</td><td><span class="trace-row-time"><#=publishTime#></span></td></tr>',dataRowYingliHeader:'<tr><th class="text-center">序号</th><th><input data-action="checkedAll" type="checkbox" checked="checked" /> 追号期次</th><th>倍数</th><th>金额</th><th>奖金</th><th>预期盈利金额</th><th>预期盈利率</th></tr>',dataRowLirunlvTemplate:'<tr><td class="text-center"><#=No#></td><td><input data-action="checkedRow" class="trace-row-checked" type="checkbox" checked="checked"> <span class="trace-row-number"><#=traceNumber#></span></td><td><input class="trace-row-multiple" value="<#=multiple#>" type="text" style="width:30px;text-align:center;"> 倍</td><td>&yen; <span class="trace-row-money"><#=money#></span> 元</td><td>&yen; <span class="trace-row-userGroupMoney"><#=userGroupMoney#></span> 元</td><td>&yen; <span class="trace-row-winTotalAmount"><#=winTotalAmout#></span> 元</td><td><span class="trace-row-yinglilv"><#=yinglilv#></span>%</td></tr>'},l=e.Games,u=function(e,t,a){var e=""+e,a=a||1e9;return e=e.replace(/[^\d]/g,""),e=""==e?t:Number(e)>a?a:e,Number(e)},c=function(e){return e=e.replace(/[^\d]/g,""),Number(e)},o={init:function(e){var t=this;t.opts=e,l.setCurrentGameTrace(t),t.panel=$(e.mainPanel),t.panelIsVisible=!1,t.TraceTab=null,t.TraceAdvancedTab=null,t.orderData=null,t.traceType=e.defaultType,t.times=0,t.traceStartNumber="",t.currentTraceNumber="",t.isTrace=0,t.savedTraceData=null,t.advancedType=e.advancedTypeHas[0],t.typeTypeType="a",t.initEvent(),t.setCurrentTraceNumber(),l.getCurrentGame().addEvent("changeDynamicConfig",function(){t.buildStartNumberSelectDom(),t.updateTableNumber()})},getIsTrace:function(){return this.isTrace},setIsTrace:function(e){this.isTrace=Number(e),1>e?$("#J-button-trace-confirm").addClass("disable"):$("#J-button-trace-confirm").removeClass("disable")},setAdvancedType:function(e){this.advancedType="[object Number]"==Object.prototype.toString.call(e)?this.getAdvancedTypeBuIndex(e):e},getAdvancedType:function(){return this.advancedType},getAdvancedTypeBuIndex:function(e){var t=this,a=t.defConfig.advancedTypeHas,r=a.length;return r>e?a[e]:""},initEvent:function(){var t=this;t.TraceTab=new e.Tab({par:"#J-trace-panel",triggers:".trace-radio a",panels:".chase-tab-content",currPanelClass:"chase-tab-content-current",eventType:"click"}),t.TraceTab.addEvent("afterSwitch",function(e,a){var r=["tongbei","lirunlv","fanbei"];a<r.length&&t.setTraceType(r[a]),t.updateStatistics()}),t.TraceAdvancedTab=new e.Tab({par:"#J-trace-advanced-type-panel",triggers:".tab-title li",panels:".tab-content li",eventType:"click"}),t.TraceAdvancedTab.addEvent("afterSwitch",function(e,a){var r=this.getPanel(a).find(".trace-advanced-type-switch");t.setAdvancedType(a),r.each(function(){return this.checked?(t.setTypeTypeType($(this).parent().attr("data-type")),!1):void 0})});var a=new e.Hover({triggers:"#J-trace-iswintimesstop-hover",panels:"#chase-stop-tip-1",currPanelClass:"chase-stop-tip-current",hoverDelayOut:300});$("#chase-stop-tip-1").mouseleave(function(){a.hide()}),$("#J-chase-stop-switch-1").click(function(e){e.preventDefault(),$("#J-trace-iswintimesstop-panel").hide(),$("#J-trace-iswinstop-panel").show(),$("#J-trace-iswintimesstop").get(0).checked=!1,$("#J-trace-iswinstop").get(0).checked=!0,$("#J-trace-iswinstop-money").removeAttr("disabled"),$("#J-trace-iswintimesstop-times").attr("disabled","disabled")}),$("#J-chase-stop-switch-2").click(function(e){e.preventDefault(),$("#J-trace-iswinstop-panel").hide(),$("#J-trace-iswintimesstop-panel").show(),$("#J-trace-iswintimesstop").get(0).checked=!0,$("#J-trace-iswinstop").get(0).checked=!1,$("#J-trace-iswinstop-money").attr("disabled","disabled"),$("#J-trace-iswintimesstop-times").removeAttr("disabled")}),$("#J-trace-iswinstop-money").keyup(function(){this.value=u(this.value,1,999999)}),$("#J-trace-iswintimesstop-times").keyup(function(){this.value=u(this.value,1,999999)}),$("#J-trace-iswintimesstop").click(function(){var e=$("#J-trace-iswintimesstop-times");this.checked?e.attr("disabled",!1).focus():e.attr("disabled","disabled")}),$("#J-trace-iswinstop").click(function(){var e=$("#J-trace-iswinstop-money");this.checked?e.attr("disabled",!1).focus():e.attr("disabled","disabled")}),$("#J-trace-normal-times").keyup(function(){var e,a=l.getCurrentGame().getGameConfig().getInstance().getTraceMaxTimes(),r=""+this.value,n=$("#J-function-select-tab").find(".function-select-title li"),i="current";r=r.replace(/[^\d]/g,""),r=""==r?1:Number(r)>a?a:r,this.value=r,e=Number(r),e>0&&20>=e&&e%5==0&&n.removeClass(i).eq(e/5-1).addClass(i),t.buildDetail()});var r=new e.Tab({par:"#J-function-select-tab",triggers:".function-select-title li",panels:".function-select-panel li",eventType:"click",index:1});r.addEvent("afterSwitch",function(e,a){var r=this,n=parseInt(r.getTrigger(a).text());$("#J-trace-normal-times").val(n),t.buildDetail()}),t.tongbeiSelectMultiple=new e.Select({realDom:"#J-trace-tongbei-multiple-select",cls:"w-1",isInput:!0,expands:{inputEvent:function(){var e=this;e.getInput().keyup(function(){var t=this.value,a=99999999;this.value=this.value.replace(/[^\d]/g,""),t=Number(this.value),t>a&&(this.value=a),e.setValue(this.value)})}}}),t.tongbeiSelectMultiple.addEvent("change",function(e,t){$("#J-trace-tongbei-multiple").val(t)}),$(".J-trace-tongbei-times-filter > a").on("click",function(){var e=$(this),t=e.data("value");return e.hasClass("current")?!1:(e.addClass("current").siblings(".current").removeClass("current"),$("#J-trace-tongbei-times").val(t),!1)}).eq(0).trigger("click"),t.panel.find(".chase-table").keyup(function(e){var a=$(e.target),r=t.getOrderData().amount;if(a.hasClass("trace-row-multiple")){var n=Number(c(a.val())),i=t.getRowTableType(),u=Number(l.getCurrentGameOrder().getOrderMaxMultiple().maxnum);0==n?(a.val(a.val().replace(/^0/g,"")),t.updateStatistics()):n>u?a.val(u):(a.parent().parent().find(".trace-row-money").html(t.formatMoney(r*n)),a.val(n),("trace_advanced_yingli_a"==i||"trace_advanced_yingli_b"==i||"trace_advanced_yinglilv_a"==i||"trace_advanced_yinglilv_b"==i)&&t.rebuildYinglilvRows(),t.updateStatistics())}}).on("blur",".trace-row-multiple",function(e){var a=$(e.target);a.val(u(a.val(),1,l.getCurrentGameOrder().getOrderMaxMultiple().maxnum)),t.updateStatistics()}),setTimeout(function(){t.buildStartNumberSelectDom()},10),$("#J-trace-advanced-times").keyup(function(){this.value=u(this.value,10,Number($("#J-trace-number-max").text()))}),$("#J-trace-advance-multiple").keyup(function(e){var t=$(e.target),a=Number(c(t.val())),r=Number(l.getCurrentGameOrder().getOrderMaxMultiple().maxnum);t.val(0==a?t.val().replace(/^0/g,""):a>r?r:a)}).blur(function(){this.value=u(this.value,1,l.getCurrentGameOrder().getOrderMaxMultiple().maxnum)}),t.panel.find(".trace-advanced-type-switch").click(function(){var e,a=$(this),r=a.parent(),n=r.parent().children();n.each(function(i){e=n.get(i),r.get(0)!=e?$(e).find('input[type="text"]').attr("disabled","disabled"):($(e).find('input[type="text"]').attr("disabled",!1).eq(0).focus(),t.setTypeTypeType(r.attr("data-type"))),this.value=a.parent().hasClass("trace-input-multiple")?u(this.value,1,l.getCurrentGameOrder().getOrderMaxMultiple().maxnum):u(this.value,1,99999999)})}),$("#J-trace-advanced-type-panel").on("keyup","input[type=text]",function(e){var t=$(e.target);this.value=t.hasClass("trace-input-multiple")?u(this.value,1,l.getCurrentGameOrder().getOrderMaxMultiple().maxnum):u(this.value,1,99999999)}),$("#J-trace-panel .trace-button-detail").click(function(){t.confirmSetting(),t.applyTraceData()}),t.panel.find(".chase-table").click(function(e){var a,r=$(e.target),n=$.trim(r.attr("data-action")),i=!0,l=t.getTraceType();if(n&&""!=n)switch(n){case"checkedAll":i=r.get(0).checked?!0:!1,a=t.getRowTableType(l),t.getRowTable(l).find(".trace-row-checked").each(function(){this.checked=i}),"lirunlv"==a&&t.rebuildYinglilvRows(),t.updateStatistics();break;case"checkedRow":r.size()>0&&(a=t.getRowTableType(),("trace_advanced_yingli_a"==a||"trace_advanced_yingli_b"==a||"trace_advanced_yinglilv_a"==a||"trace_advanced_yinglilv_b"==a)&&t.rebuildYinglilvRows(),t.updateStatistics())}})},buildStartNumberSelectDom:function(){var t,a=this,r=l.getCurrentGame().getGameConfig().getInstance(),n=r.getGameNumbers(),i=n.length,u=0,c=[],o=r.getCurrentGameNumber(),m="(当前期)",s=m,d="";for(a.traceStartNumberSelect&&(t=a.traceStartNumberSelect.getValue());i>u;u++)s=o==n[u].number?m:"",d=a.traceStartNumberSelect&&n[u].number==t?' selected="selected" ':"",c.push('<option value="'+n[u].number+'" '+d+" >"+n[u].number+s+"</option>");$("#J-traceStartNumber").html(c.join("")),$("#J-trace-number-max").text(i),a.traceStartNumberSelect&&a.traceStartNumberSelect.dom.remove(),a.traceStartNumberSelect=new e.Select({realDom:"#J-traceStartNumber",cls:"chase-trace-startNumber-select"}),a.traceStartNumberSelect.addEvent("change",function(e,t){a.setTraceStartNumber(t)})},updateTableNumber:function(){var e,t,a,r,n,i,u,c,o=this,m=l.getCurrentGame().getGameConfig().getInstance().getGameNumbers(),s=m.length,d=l.getCurrentGame().getGameConfig().getInstance().getCurrentGameNumber(),g="",p="",b='<span class="icon-period-current"></span>';s>0&&(e=o.getNormalRowTable().find("tr"),t=o.getAdvancedRowTable().find("tr"),u=o.getStartNumberIndexByNumber(a),e.each(function(e){return 0==e?!0:(r=$(this),n=r.find(".trace-row-number"),i=r.find(".trace-row-time"),multipleDom=r.find(".trace-row-multiple"),a=n.text().replace(/[^\d]/g,""),c=r.find(".text-center"),r.find(".trace-row-multiple").removeAttr("disabled"),void(s>u+1&&(g=m[u+1].number==d?b:"",n.html(m[u+1].number+g),multipleDom.text("1"),i.text(m[u+1].time),c.html("").html(e),p=n.text().substr(0,8),u++)))}),u=o.getStartNumberIndexByNumber(a),t.each(function(e){return 0==e?!0:(r=$(this),n=r.find(".trace-row-number"),i=r.find(".trace-row-time"),multipleDom=r.find(".trace-row-multiple"),a=n.text().replace(/[^\d]/g,""),c=r.find(".text-center"),r.find(".trace-row-multiple").removeAttr("disabled"),void(s>u+1&&(g=m[u+1].number==d?b:"",n.html(m[u+1].number+g),multipleDom.text("1"),i.text(m[u+1].time),c.html("").html(e),p=n.text().substr(0,8),u++)))}))},rebuildYinglilvRows:function(){var e=this,t=e.getRowTable().find("tr"),a=e.getOrderData(),r=e.getWinMoney(),n=null,i=null,l=null,u=1,c=null,o=0,m=null,s=null,d=null,g=-1;costAmount=0,t.each(function(t){t>0&&(n=$(this),i=n.find(".trace-row-checked"),i.size()>0&&i.get(0).checked&&(l=n.find(".trace-row-multiple"),u=Number(l.val()),c=n.find(".trace-row-money"),o=Number(c.text().replace(",","")),m=n.find(".trace-row-userGroupMoney"),s=n.find(".trace-row-winTotalAmount"),d=n.find(".trace-row-yinglilv"),costAmount+=a.amount*u,c.text(e.formatMoney(a.amount*u)),m.text(e.formatMoney(r*u)),s.text(e.formatMoney(r*u-costAmount)),g=(r*u-costAmount)/costAmount*100,d.text(Number(g).toFixed(2))))})},setTypeTypeType:function(e){this.typeTypeType=e},getTypeTypeType:function(){return this.typeTypeType},getIsWinStop:function(){var e=$("#J-trace-iswintimesstop"),t=$("#J-trace-iswinstop");return e.get(0).checked?1:t.get(0).checked?2:0},getTraceWinStopValue:function(){var e=this,t=e.getIsWinStop();return 1==t?Number($("#J-trace-iswintimesstop-times").val()):2==t?Number($("#J-trace-iswinstop-money").val()):-1},updateStatistics:function(){var e=this,t=e.getResultData();$("#J-trace-statistics-times").html(t.times),$("#J-trace-statistics-lotterys-num").html(t.lotterysNum),$("#J-trace-statistics-amount").html(e.formatMoney(t.amount))},getSavedTraceData:function(){return this.savedTraceData},setSavedTraceData:function(e){this.savedTraceData=e},getResultData:function(){var e,t,a,r,n,i=this,u=i.getOrderData(),c=i.getRowTable(i.getTraceType()).find("tr"),o=0,m=0,s=0,d=[],g={times:0,lotterysNum:0,amount:0,orderData:u,traceData:[],traceType:i.getTraceType()},p="",b=l.getCurrentGame().getGameConfig().getInstance().getGameNumbers();return c.each(function(l){e=$(this),t=e.find(".trace-row-checked"),tracenumber=e.find(".trace-row-number"),traceNo=e.find(".text-center"),0!=l&&traceNo.html("").html(l),t.size()>0&&t.get(0).checked?(a=t.parent(),n=i.getStartNumberIndexByNumber(a.find(".trace-row-number").text()),n=-1==n?0:n,r=b[n].issueCode,e.find(".trace-row-multiple").removeAttr("disabled"),"0"==e.find(".trace-row-multiple").val()&&(e.find(".trace-row-multiple").val("1"),e.find(".trace-row-money").text(i.formatMoney(1*u.amount))),d.push({traceNumber:a.find(".trace-row-number").text(),issueCode:r,multiple:Number(a.parent().find(".trace-row-multiple").val())}),o++,s+=Number(e.find(".trace-row-money").text().replace(/,/g,""))):(e.find(".trace-row-money").text("0"),e.find(".trace-row-multiple").val("0"),e.find(".trace-row-multiple").attr("disabled","disabled").css("border","1px solid #CECECE")),p=tracenumber.text().substr(0,8)}),u&&(m=o*u.count,g={times:o,lotterysNum:m,amount:s,orderData:u,traceData:d,traceType:i.getTraceType()}),g},updateOrder:function(e){var t=this,a=l.getCurrentGameOrder().getTotal(),r=t.getRowTableType(),n=l.getCurrentGameOrder().getOrderMaxMultiple(),i=n.maxnum,u=Number(t.normalSelectMultiple.getValue()),c=Number($("#J-trace-advance-multiple").val());t.setOrderData(a),u>i&&t.normalSelectMultiple.setValue(i),c>i&&$("#J-trace-advance-multiple").val(i),e||"trace_advanced_fanbei_a"!=r&&"trace_advanced_fanbei_b"!=r&&"trace_advanced_yingli_a"!=r&&"trace_advanced_yingli_b"!=r&&"trace_advanced_yinglilv_a"!=r&&"trace_advanced_yinglilv_b"!=r||l.getCurrentGameMessage().show({type:"normal",closeFun:function(){this.hide()},data:{tplData:{msg:"您的方案已被修改，如果需要根据最新方案进行追号，请点击生成追号计划按钮"}}}),t.getAdvancedRowTable().html(""),t.updateDetail(a.amount),t.updateStatistics()},updateDetail:function(e){var t,a=this,r=a.getTable().find("tr"),n=null,i=a.getRowTableType();"trace_advanced_yingli_a"==i||"trace_advanced_yingli_b"==i||"trace_advanced_yinglilv_a"==i||"trace_advanced_yinglilv_b"==i?a.rebuildYinglilvRows():(t=a.getAdvancedRowTable().attr("data-type"),("trace_advanced_fanbei_a"==t||"trace_advanced_fanbei_b"==t)&&(r=a.getAdvancedTable().find("tr"),r.each(function(){n=$(this),rowMoney=n.find(".trace-row-money"),rowMultiple=Number(n.find(".trace-row-multiple").val()),rowMoney.text(a.formatMoney(rowMultiple*e))}))),r=a.getNormalTable().find("tr"),r.each(function(){n=$(this),rowMoney=n.find(".trace-row-money"),rowMultiple=Number(n.find(".trace-row-multiple").val()),rowMoney.text(a.formatMoney(rowMultiple*e))})},getWinMoney:function(){for(var e=this,t=e.getOrderData().orders,a=0,r=t.length,n=0;r>a;a++)n+=e.getPlayGroupMoneyByGameMethodName(t[a].mid)*t[a].moneyUnit;return n},confirmSetting:function(){var e=this;e.setOrderData(l.getCurrentGameOrder().getTotal()),e.buildDetail()},isSameGameMethod:function(){var e=this,t=e.getOrderData().orders,a="",r=-1;for(i=0,len=t.length;len>i;i++){if(""!=a){if(a!=t[i].type)return!1}else a=t[i].type;if(-1!=r){if(r!=t[i].moneyUnit)return!1}else r=t[i].moneyUnit}return!0},getSameGameMethodName:function(){var e=this,t=e.getOrderData().orders;return t.length>0?t[0].type:void 0},getSameGameMoneyUnti:function(){var e=this,t=e.getOrderData().orders;return t.length>0?t[0].moneyUnit:void 0},setOrderData:function(e){this.orderData=e},getOrderData:function(){return null==this.orderData?{count:0,amount:0,orders:[]}:this.orderData},getStartNumberIndexByNumber:function(e){for(var t=l.getCurrentGame().getGameConfig().getInstance().getGameNumbers(),a=t.length,r=0;a>r;r++)if(t[r].number==e)return r;return-1},getStartNumberByIndex:function(e){var t=l.getCurrentGame().getGameConfig().getInstance().getGameNumbers();return t.length>e?t[e]:{}},buildDetail:function(){var e=this,t=e.getTraceType(),a=l.getCurrentGameMessage();return e.setOrderData(l.getCurrentGameOrder().getTotal()),orderAmount=e.getOrderData().amount,0>=orderAmount?void a.show({type:"mustChoose",msg:"请至少选择一注投注号码！",data:{tplData:{msg:"请至少选择一注投注号码！"}}}):($.isFunction(e["trace_"+t])&&e["trace_"+t].call(e),void e.updateStatistics())},trace_lirunlv:function(){var e,t=this,a=t.getTraceType(),r=t.defConfig.dataRowTemplate,n=[],i=t.getTimes(a),u=i,c=l.getCurrentGameOrder().getOrderMaxMultiple(),o=t.getMultiple(),m=[],s=Number($("#J-trace-lirunlv-num").val())/100,d=t.getSameGameMoneyUnti(),g=0,p=0,r=t.defConfig.dataRowLirunlvTemplate,b=t.getOrderData().orders,f=l.getCurrentGame().getGameConfig().getInstance().getCurrentGameNumber(),v='<span class="icon-period-current"></span>',h="",y=t.traceStartNumberSelect.getValue(),T=0,w=!1,C=l.getCurrentGame().getGameConfig().getInstance().getGameNumbers();if(!t.isSameGameMethod())return void l.getCurrentGameMessage().show({type:"mustChoose",msg:"",data:{tplData:{msg:"利润率追号不支持混投<br />请确保您的投注都为同一玩法类型<br />且元角模式一致。"}}});if($.each(b,function(){var e=l.getCurrentGame().getGameConfig().getInstance().getMethodById(this.mid),t=l.getCurrentGame().getGameConfig().getInstance().getPrizeById(this.mid);g+=Number(t.prize),p+=this.num*Number(e.price)}),g*=d,p*=d,n.push(t.defConfig.dataRowYingliHeader),e=t.getStartNumberIndexByNumber(y),u=i,m=t.getMultipleByYinglilv(s,g,p,u,o,c.maxnum),m.length<1)return void alert("您设置的参数无法达到盈利，请重新设置");for($.each(m,function(){return this.oldMultiple>c.maxnum?(w=!0,alert("生成方案中的倍数超过了系统最大允许设置的倍数，将自动调整为系统最大可设置倍数"),!1):void 0}),T=0;T<m.length;T++)h=C[T+e].number,h==f&&(h+=v),rowData={No:T+1,traceNumber:h,multiple:m[T].multiple,money:t.formatMoney(p*m[T].multiple),userGroupMoney:t.formatMoney(g*m[T].multiple),winTotalAmout:t.formatMoney(m[T].winAmountAll),yinglilv:Number(m[T].winAmountAll/m[T].amountAll*100).toFixed(2)},n.push(t.formatRow(r,rowData));t.getRowTable(a).html(n.join("")),t.getRowTable(a).attr("data-type","lirunlv")},trace_tongbei:function(){{var e,t,a,r=this,n=r.getTraceType(),i=r.defConfig,u=i.dataRowTemplate,c=[],n=r.getTraceType(),o=r.getTimes(n),m=Number($("#J-trace-tongbei-multiple").val()),s=(l.getCurrentGameOrder().getOrderMaxMultiple().maxnum,0),d=0,g=l.getCurrentGame().getGameConfig().getInstance().getCurrentGameNumber(),p='<span class="icon-period-current"></span>',b="",f=r.traceStartNumberSelect.getValue();l.getCurrentGame().getGameConfig().getInstance().getGameNumbers().length}for(r.setOrderData(l.getCurrentGameOrder().getTotal()),s=r.getOrderData().amount,c.push(i.dataRowHeader),e=r.getStartNumberIndexByNumber(f),d=e,o+=d;o>d;d++)t=r.getStartNumberByIndex(d),b=t.number,b==g&&(b+=p),t.number&&(a={No:d+1,traceNumber:b,multiple:m,money:r.formatMoney(s*m),publishTime:t.time},c.push(r.formatRow(u,a)));r.getRowTable(n).html(c.join("")),r.getRowTable(n).attr("data-type","tongbei")},trace_fanbei:function(){var e,t=this,a=t.getTraceType(),r=t.defConfig.dataRowTemplate,n=[],i=t.getTimes(a),u=t.getOrderData().orders,c=t.getSameGameMoneyUnti(),o=l.getCurrentGameOrder().getOrderMaxMultiple(),m=o.maxnum,s=Number($("#J-trace-fanbei-jump").val()),d=s,g=Number($("#J-trace-fanbei-multiple").val()),p=g,b=Number($("#J-trace-fanbei-num").val()),f=0,v=0,h=l.getCurrentGame().getGameConfig().getInstance().getCurrentGameNumber(),y='<span class="icon-period-current"></span>',T="",w=t.traceStartNumberSelect.getValue(),C=l.getCurrentGame().getGameConfig().getInstance().getGameNumbers(),N=1;for($.each(u,function(){var e=l.getCurrentGame().getGameConfig().getInstance().getMethodById(this.mid);f+=this.num*e.price}),f*=c,e=t.getStartNumberIndexByNumber(w),n.push(t.defConfig.dataRowHeader),v+=e,i+=e;i>v;v++)1>d&&(d=s,p*=b),p>m&&(p=m),T=C[v].number,T==h&&(T+=y),rowData={No:N,traceNumber:T,multiple:p,money:t.formatMoney(f*p),publishTime:C[v].time},d-=1,N++,n.push(t.formatRow(r,rowData));t.getRowTable(a).html(n.join("")),t.getRowTable(a).attr("data-type","fanbei")},trace_normal:function(){{var e,t,a,r=this,n=r.defConfig,i=n.dataRowTemplate,u=[],c=(r.getTraceType(),r.getTimes()),o=r.getMultiple(),m=(l.getCurrentGameOrder().getOrderMaxMultiple().maxnum,0),s=0,d=l.getCurrentGame().getGameConfig().getInstance().getCurrentGameNumber(),g='<span class="icon-period-current"></span>',p="",b=r.traceStartNumberSelect.getValue();l.getCurrentGame().getGameConfig().getInstance().getGameNumbers().length}for(r.setOrderData(l.getCurrentGameOrder().getTotal()),m=r.getOrderData().amount,u.push(n.dataRowHeader),e=r.getStartNumberIndexByNumber(b),s=e,c+=s;c>s;s++)t=r.getStartNumberByIndex(s),p=t.number,p==d&&(p+=g),t.number&&(a={No:s+1,traceNumber:p,multiple:o,money:r.formatMoney(m*o),publishTime:t.time},u.push(r.formatRow(i,a)));r.getRowTable().html(u.join("")),r.getRowTable().attr("data-type","trace_normal")},trace_advanced:function(){var e=this,t=e.getTraceType(),a=e.getAdvancedType(),r=e.getTypeTypeType(),n="trace_"+t+"_"+a+"_"+r;return e.isSameGameMethod()||"yingli"!=a&&"yinglilv"!=a?($.isFunction(e[n])&&e[n](),void e.getRowTable().attr("data-type",n)):void l.getCurrentGameMessage().show({type:"mustChoose",msg:"",data:{tplData:{msg:"盈利金额追号不支持混投<br />请确保您的投注都为同一玩法类型<br />且元角模式一致。"}}})},trace_advanced_fanbei_a:function(){var e,t=this,a=t.defConfig.dataRowTemplate,r=[],n=t.getTimes(),i=t.getOrderData().orders,u=t.getSameGameMoneyUnti(),c=l.getCurrentGameOrder().getOrderMaxMultiple(),o=c.maxnum,m=Number($("#J-trace-advanced-fanbei-a-jiange").val()),s=m,d=(t.getMultiple(),1),g=Number($("#J-trace-advanced-fanbei-a-multiple").val()),p=0,b=0,f=l.getCurrentGame().getGameConfig().getInstance().getCurrentGameNumber(),v='<span class="icon-period-current"></span>',h="",y=t.traceStartNumberSelect.getValue(),T=l.getCurrentGame().getGameConfig().getInstance().getGameNumbers(),w=1;for($.each(i,function(){var e=l.getCurrentGame().getGameConfig().getInstance().getMethodById(this.mid);p+=this.num*e.price}),p*=u,e=t.getStartNumberIndexByNumber(y),r.push(t.defConfig.dataRowHeader),b+=e,n+=e;n>b;b++)1>s&&(s=m,d*=g),d>o&&(d=o),h=T[b].number,h==f&&(h+=v),rowData={No:w,traceNumber:h,multiple:d,money:t.formatMoney(p*d),publishTime:T[b].time},s-=1,w++,r.push(t.formatRow(a,rowData));t.getRowTable().html(r.join(""))},trace_advanced_fanbei_b:function(){var e,t,a,r=this,n=r.defConfig.dataRowTemplate,i=[],u=r.getTimes(),c=r.getOrderData().orders,o=r.getSameGameMoneyUnti(),m=l.getCurrentGameOrder().getOrderMaxMultiple().maxnum,s=(Number($("#J-trace-advanced-fanbei-a-jiange").val()),r.getMultiple(),1),d=(Number($("#J-trace-advanced-fanbei-a-multiple").val()),0),g=0,p=Number($("#J-trace-advanced-fanbei-b-num").val()),b=Number($("#J-trace-advance-multiple").val()),f=Number($("#J-trace-advanced-fanbei-b-multiple").val()),v=l.getCurrentGame().getGameConfig().getInstance().getCurrentGameNumber(),h='<span class="icon-period-current"></span>',y="",T=r.traceStartNumberSelect.getValue(),w=(l.getCurrentGame().getGameConfig().getInstance().getGameNumbers().length,""),C="";for($.each(c,function(){var e=l.getCurrentGame().getGameConfig().getInstance().getMethodById(this.mid);d+=this.num*e.price}),d*=o,i.push(r.defConfig.dataRowHeader),e=r.getStartNumberIndexByNumber(T),g=e,u+=g,t=r.getStartNumberByIndex(g);u>g&&(s=p+e>g?b>m?m:b:f>m?m:f,t=r.getStartNumberByIndex(g),t.number);g++)y=t.number,y==v&&(y+=h),C=g+1,a={No:C,traceNumber:y,multiple:s,money:r.formatMoney(d*s),publishTime:t.time},w=y.substr(0,8),i.push(r.formatRow(n,a));r.getRowTable().html(i.join(""))},trace_advanced_yingli_a:function(e){var t,a,r,n=this,i=n.defConfig.dataRowTemplate,u=[],c=n.getTimes(),o=l.getCurrentGameOrder().getOrderMaxMultiple(),m=e||o.maxnum,s=l.getCurrentGame().getGameConfig().getInstance().getMethodFullName(o.gameMethod).join("-"),d=n.getMultiple(),g=0,p=(n.getSameGameMethodName(),Number($("#J-trace-advanced-yingli-a-money").val())),b=(n.getSameGameMoneyUnti(),n.getWinMoney()),d=1,i=n.defConfig.dataRowYingliTemplate,f=n.getOrderData().orders,v=0,h=0,y=0,T=0,w=l.getCurrentGame().getGameConfig().getInstance().getCurrentGameNumber(),C='<span class="icon-period-current"></span>',N="",G=n.traceStartNumberSelect.getValue(),M=(l.getCurrentGame().getGameConfig().getInstance().getGameNumbers().length,""),x="";for(u.push(n.defConfig.dataRowYingliHeader),t=n.getStartNumberIndexByNumber(G),g=t,c+=g,a=n.getStartNumberByIndex(g);c>g;g++){if(v=0,y=0,d=1,$.each(f,function(){var e=this,t=e.num,a=e.onePrice,r=e.multiple,n=t*r*a,i=b*r;y+=i,v+=n}),d=n.getMultipleByMoney(b,p,v,h),0>d)return void alert("盈利金额追号无法到达您预期设定的目标值，请修改您的设置");if(d>m){if(l.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){n.trace_advanced_yingli_a(m),n.updateStatistics(),this.hide()},data:{tplData:{msg:"盈利金额追号中的<b>["+s+"]</b>的倍数超过了最大倍数限制，系统将自动调整为最大可设置倍数"}}}),!e)return;d=e}if(v*=d,h+=v,y=b*d-h,T=y/h,a=n.getStartNumberByIndex(g),!a.number)break;N=a.number,N==w&&(N+=C),x=g+1,r={No:x,traceNumber:N,multiple:d,money:n.formatMoney(v),userGroupMoney:n.formatMoney(b*d),winTotalAmout:n.formatMoney(y),yinglilv:Number(100*T).toFixed(2)},M=N.substr(0,8),u.push(n.formatRow(i,r))}n.getRowTable().html(u.join(""))},trace_advanced_yingli_b:function(e){var t,a,r,n=this,i=n.defConfig.dataRowTemplate,u=[],c=n.getTimes(),o=l.getCurrentGameOrder().getOrderMaxMultiple(),m=e||o.maxnum,s=l.getCurrentGame().getGameConfig().getInstance().getMethodFullName(o.gameMethod).join("-"),d=n.getMultiple(),g=0,p=(n.getSameGameMethodName(),Number($("#J-trace-advanced-yingli-b-num").val())),b=Number($("#J-trace-advanced-yingli-b-money1").val()),f=Number($("#J-trace-advanced-yingli-b-money2").val()),v=(n.getSameGameMoneyUnti(),n.getWinMoney()),d=1,i=n.defConfig.dataRowYingliTemplate,h=n.getOrderData().orders,y=0,T=0,w=0,C=0,N=l.getCurrentGame().getGameConfig().getInstance().getCurrentGameNumber(),G='<span class="icon-period-current"></span>',M="",x=n.traceStartNumberSelect.getValue(),S=(l.getCurrentGame().getGameConfig().getInstance().getGameNumbers().length,""),J="";for(u.push(n.defConfig.dataRowYingliHeader),t=n.getStartNumberIndexByNumber(x),g=t,c+=g,a=n.getStartNumberByIndex(g);c>g;g++){if(g+1>p+t&&(b=f),y=0,w=0,d=1,$.each(h,function(){var e=this,t=e.num,a=e.onePrice,r=e.multiple,n=t*r*a,i=v*r;w+=i,y+=n}),d=n.getMultipleByMoney(v,b,y,T),0>d)return void l.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){this.hide()},data:{tplData:{msg:"盈利金额追号无法到达您预期设定的目标值，请修改您的设置"}}});if(d>m){if(l.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){n.trace_advanced_yingli_b(m),n.updateStatistics(),this.hide()},data:{tplData:{msg:"盈利金额追号中的<b>["+s+"]</b>的倍数超过了最大倍数限制，系统将自动调整为最大可设置倍数"}}}),!e)return;d=e}if(y*=d,T+=y,w=v*d-T,C=w/T,a=n.getStartNumberByIndex(g),!a.number)break;M=a.number,M==N&&(M+=G),r={No:J,traceNumber:M,multiple:d,money:n.formatMoney(y),userGroupMoney:n.formatMoney(v*d),winTotalAmout:n.formatMoney(w),yinglilv:Number(100*C).toFixed(2)},S=M.substr(0,8),u.push(n.formatRow(i,r))}n.getRowTable().html(u.join(""))},trace_advanced_yinglilv_a:function(){var e,t=this,a=t.defConfig.dataRowTemplate,r=[],n=t.getTimes(),i=l.getCurrentGameOrder().getOrderMaxMultiple(),u=t.getMultiple(),c=[],o=Number($("#J-trace-advanced-yinglilv-a").val())/100,m=t.getSameGameMoneyUnti(),s=0,d=0,a=t.defConfig.dataRowYingliTemplate,g=t.getOrderData().orders,p=l.getCurrentGame().getGameConfig().getInstance().getCurrentGameNumber(),b='<span class="icon-period-current"></span>',f="",v=t.traceStartNumberSelect.getValue(),h=0,y=l.getCurrentGame().getGameConfig().getInstance().getGameNumbers();if($.each(g,function(){var e=l.getCurrentGame().getGameConfig().getInstance().getMethodById(this.mid),t=l.getCurrentGame().getGameConfig().getInstance().getPrizeById(this.mid);s+=t.prize,d+=this.num*e.price}),s*=m,d*=m,r.push(t.defConfig.dataRowYingliHeader),e=t.getStartNumberIndexByNumber(v),c=t.getMultipleByYinglilv(o,s,d,n,u,i.maxnum),c.length<1)return void alert("您设置的参数无法达到盈利，请重新设置");for($.each(c,function(){return this.oldMultiple>i.maxnum?(alert("生成方案中的倍数超过了系统最大允许设置的倍数，将自动调整为系统最大可设置倍数"),!1):void 0});h<c.length;h++)f=y[h+e].number,f==p&&(f+=b),rowData={No:h+1,traceNumber:f,multiple:c[h].multiple,money:t.formatMoney(d*c[h].multiple),userGroupMoney:t.formatMoney(s*c[h].multiple),winTotalAmout:t.formatMoney(c[h].winAmountAll),yinglilv:Number(c[h].winAmountAll/c[h].amountAll*100).toFixed(2)},r.push(t.formatRow(a,rowData));t.getRowTable().html(r.join(""))},trace_advanced_yinglilv_b:function(){var e,t=this,a=t.defConfig.dataRowTemplate,r=[],n=t.getTimes(),i=n,u=l.getCurrentGameOrder().getOrderMaxMultiple(),c=t.getMultiple(),o=[],m=Number($("#J-trace-advanced-yingli-b-yinglilv1").val())/100,s=Number($("#J-trace-advanced-yingli-b-yinglilv2").val())/100,d=0,g=Number($("#J-trace-advanced-yinglilv-b-num").val()),p=t.getSameGameMoneyUnti(),b=0,f=0,a=t.defConfig.dataRowYingliTemplate,v=t.getOrderData().orders,h=l.getCurrentGame().getGameConfig().getInstance().getCurrentGameNumber(),y='<span class="icon-period-current"></span>',T="",w=t.traceStartNumberSelect.getValue(),C=0,N=!1,G=l.getCurrentGame().getGameConfig().getInstance().getGameNumbers();if($.each(v,function(){var e=l.getCurrentGame().getGameConfig().getInstance().getMethodById(this.mid),t=l.getCurrentGame().getGameConfig().getInstance().getPrizeById(this.mid);b+=t.prize,f+=this.num*e.price}),b*=p,f*=p,r.push(t.defConfig.dataRowYingliHeader),e=t.getStartNumberIndexByNumber(w),i=g>=n?n:g,o=t.getMultipleByYinglilv(m,b,f,i,c,u.maxnum),o.length<1)return void alert("您设置的参数无法达到盈利，请重新设置");for($.each(o,function(){return this.oldMultiple>u.maxnum?(N=!0,alert("生成方案中的倍数超过了系统最大允许设置的倍数，将自动调整为系统最大可设置倍数"),!1):void 0});C<o.length;C++)T=G[C+e].number,T==h&&(T+=y),rowData={No:C+1,traceNumber:T,multiple:o[C].multiple,money:t.formatMoney(f*o[C].multiple),userGroupMoney:t.formatMoney(b*o[C].multiple),winTotalAmout:t.formatMoney(o[C].winAmountAll),yinglilv:Number(o[C].winAmountAll/o[C].amountAll*100).toFixed(2)},r.push(t.formatRow(a,rowData));if(n>g)for($.each(o,function(){c+=this.multiple}),i=n-g,o=t.getMultipleByYinglilv(s,b,f,i,c,u.maxnum),$.each(o,function(){return!N&&this.oldMultiple>u.maxnum?(alert("生成方案中的倍数超过了系统最大允许设置的倍数，将自动调整为系统最大倍数"),!1):void 0}),d=C,C=0;C<o.length;C++)T=G[C+d+e].number,T==h&&(T+=y),rowData={No:C+1,traceNumber:T,multiple:o[C].multiple,money:t.formatMoney(f*o[C].multiple),userGroupMoney:t.formatMoney(b*o[C].multiple),winTotalAmout:t.formatMoney(o[C].winAmountAll),yinglilv:Number(o[C].winAmountAll/o[C].amountAll*100).toFixed(2)},r.push(t.formatRow(a,rowData));t.getRowTable().html(r.join(""))},getMultipleByYinglilv:function(e,t,a,r,n,i){for(var l,u=n*a,c=0,o=0,m=[];r>o&&(l=Math.ceil(u*(1+e)/(t-a*(1+e))),!(1>l));o++)c=l,l=0==o?l>i?i:1:l>i?i:l,0==o?u=l*a:u+=l*a,m.push({multiple:l,amountAll:u,winAmountAll:t*l-u,oldMultiple:c});return m},getMultipleByMoney:function(e,t,a,r){for(var n=1,i=1e5;i>n;n++)if(e*n-r-a*n>t)return n;return-1},getPlayGroupMoneyByGameMethodName:function(e){return Number(l.getCurrentGame().getGameConfig().getInstance().getPrizeById(e).prize)},formatRow:function(e,t){var a,r,n=t;for(a in n)n.hasOwnProperty(a)&&(r=RegExp("<#="+a+"#>","g"),e=e.replace(r,n[a]));return e},formatMoney:function(e){var e=Number(e),t=/(-?\d+)(\d{3})/;for(e=Number.prototype.toFixed?e.toFixed(3):Math.round(100*e)/100,e=""+e;t.test(e);)e=e.replace(t,"$1,$2");return e},getAdvancedTable:function(){var e=this;return e._advancedTable||(e._advancedTable=$("#J-trace-table-advanced"))},getAdvancedRowTable:function(){var e=this;return e._advancedTableContainer||(e._advancedTableContainer=$("#J-trace-table-advanced-body"))},getNormalTable:function(){var e=this;return e._table||(e._table=$("#J-trace-table"))},getNormalRowTable:function(){var e=this;return e._tableContainer||(e._tableContainer=$("#J-trace-table-body"))},getTable:function(){var e=this;return e.isAdvanced()?e._advancedTable||(e._advancedTable=$("#J-trace-table-advanced")):e._table||(e._table=$("#J-trace-table"))
},getRowTable:function(e){return $("#J-trace-table-"+e+"-body")},setCurrentTraceNumber:function(e){var t=this;t.currentTraceNumber=e},getCurrentTraceNumber:function(){return me.currentTraceNumber},setTraceStartNumber:function(e){var t=this;t.traceStartNumber=e},getTraceStartNumber:function(){return me.traceStartNumber},getMultiple:function(){var e=this;return e.isAdvanced()?e.getAdvancedMultiple():e.getNormalMultiple()},getNormalMultiple:function(){return Number(this.normalSelectMultiple.getValue())},getAdvancedMultiple:function(){return Number($("#J-trace-advance-multiple").val())},setIsWinStop:function(e){this.isWinStop=!!e},getTimes:function(e){return Number($("#J-trace-"+e+"-times").val())},getAdvancedTimes:function(){return Number($("#J-trace-advanced-times").val())},isAdvanced:function(){var e=this;return"lirunlv"==e.traceType||"fanbei"==e.traceType},setTraceType:function(e){var t=this;t.traceType=e},getTraceType:function(){return this.traceType},getRowTableType:function(e){var t=this;return t.getRowTable(e).attr("data-type")},emptyRowTable:function(){$("#J-trace-table-body").html(""),$("#J-trace-table-advanced-body").html(""),$("#J-trace-statistics-times").html("0"),$("#J-trace-statistics-lotterys-num").html("0"),$("#J-trace-statistics-amount").html("0")},checkTraceAvailabity:function(){var e=l.getCurrentGameOrder().getTotal().amount,t=l.getCurrentGameMessage();return 0>=e?(t.show({type:"mustChoose",msg:"请至少选择一注投注号码！",data:{tplData:{msg:"请至少选择一注投注号码！"}}}),!1):(l.getCurrentGameOrder().editMultiples(1),!0)},show:function(){var e=this,t=l.getCurrentGameOrder().getTotal().amount,a=l.getCurrentGameMessage();return 0>=t?void a.show({type:"mustChoose",msg:"请至少选择一注投注号码！",data:{tplData:{msg:"请至少选择一注投注号码！"}}}):(l.getCurrentGameOrder().editMultiples(1),void e.showPanel())},hide:function(){var e=this;e.hidePanel(),1==e.getIsTrace()?l.getCurrentGameOrder().editMultiples(1):l.getCurrentGameOrder().restoreMultiples()},showPanel:function(){var t=this;e.Mask.getInstance().show(),t.panel.show()},hidePanel:function(){var t=this;e.Mask.getInstance().hide(),t.panel.hide()},applyTraceData:function(){var e=this,t=Number($.trim($("#J-trace-statistics-times").text())),a=Number($.trim($("#J-trace-statistics-lotterys-num").text())),r=Number($.trim($("#J-trace-statistics-amount").text().replace(/[^\d|\.]/g,"")));t>0?(e.setIsTrace(1),l.getCurrentGameOrder().setTotalLotterysNum(a),l.getCurrentGameOrder().setTotalAmount(r)):(l.getCurrentGameOrder().restoreMultiples(),e.setIsTrace(0),e.hide())},deleteTrace:function(){var e=this;l.getCurrentGameOrder().restoreMultiples(),e.setIsTrace(0),e.emptyRowTable(),$("#J-trace-num-tip-panel").hide(),e.getTbodys().html("")},getTbodys:function(){var e=this;return e.panel.find("tbody[data-type]")},autoDeleteTrace:function(){var t=this,a=new e.Tip({cls:"j-ui-tip-b"});t.deleteTrace(),setTimeout(function(){a.getDom().fadeOut()},2e3)},reSetTab:function(){var e=this,t=e.TraceTab,a=e.TraceAdvancedTab;t.triggers.removeClass(t.defConfig.currClass),t.triggers.eq(0).addClass(t.defConfig.currClass),t.panels.removeClass(t.defConfig.currPanelClass),t.panels.eq(0).addClass(t.defConfig.currPanelClass),t.index=0,a.triggers.removeClass(a.defConfig.currClass),a.triggers.eq(0).addClass(a.defConfig.currClass),a.panels.removeClass(a.defConfig.currPanelClass),a.panels.eq(0).addClass(a.defConfig.currPanelClass),a.index=0,$("#J-trace-normal-times").val(10),$("#J-function-select-tab .function-select-title li").removeClass("current").eq(1).addClass("current"),$("#J-trace-advanced-times").val(10),$("#J-trace-advance-multiple").val(1),$("#J-trace-advanced-fanbei-a-jiange").val(2),$("#J-trace-advanced-fanbei-a-multiple").val(2),$("#J-trace-advanced-fanbei-b-num").val(5),$("#J-trace-advanced-fanbei-b-multiple").val(3),$("#J-trace-advanced-yingli-a-money").val(100),$("#J-trace-advanced-yingli-b-num").val(2),$("#J-trace-advanced-yingli-b-money1").val(100),$("#J-trace-advanced-yingli-b-money2").val(50),$("#J-trace-advanced-yinglilv-a").val(10),$("#J-trace-advanced-yinglilv-b-num").val(5),$("#J-trace-advanced-yingli-b-yinglilv1").val(30),$("#J-trace-advanced-yingli-b-yinglilv2").val(10),e.setTraceType(e.opts.defaultType),e.advancedType=e.defConfig.advancedTypeHas[0],e.typeTypeType="a",$("#J-trace-advanced-type-panel").find('input[type="radio"]').each(function(e){if((e+1)%2!=0){var t,a=$(this),r=a.parent(),n=r.parent().children();this.checked=!0,n.each(function(e){t=n.get(e),r.get(0)!=t?$(t).find('input[type="text"]').attr("disabled","disabled"):$(t).find('input[type="text"]').attr("disabled",!1)})}})}},m=e.Class(o,a);m.defConfig=n,m.getInstance=function(e){return r||(r=new m(e))},e[t]=m}(dsgame,"GameTrace",dsgame.Event);