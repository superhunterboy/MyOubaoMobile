!function(e,t,r){var a,n={containerEvent:"#J-panel-order-list-cont",containerDom:"#J-balls-order-container",totalLotterysNumDom:"#J-gameOrder-lotterys-num",totalBounsLists:"#J-bouns-lists-value",totalAmountDom:"#J-gameOrder-amount",totalRebateDom:"#J-rebate-amount",selectedClass:"game-order-current",rowTemplate:'<li data-param="action=reselect&id=<#=id#>&mid=<#=mid#>" id="gameorder-<#=id#>">	<span data-param="action=reselect&id=<#=id#>" class="name" title="<#=typeText#>"><#=typeText#></span>	<span data-param="action=reselect&id=<#=id#>" class="number" title="<#=lotterysText#>"><#=lotterysText#></span>	<span data-param="action=reselect&id=<#=id#>" class="unit"><#=moneyUnitText#></span>	<span data-param="action=reselect&id=<#=id#>" class="bet"><#=num#>注</span>	<span data-param="action=reselect&id=<#=id#>" class="multiple"><#=multiple#>倍</span>	<span data-param="action=reselect&id=<#=id#>" class="price"><span>&yen;</span><#=amountText#></span>	<span data-param="action=reselect&id=<#=id#>" class="prizeGroup" prizeGroup="<#=prizeGroup#>" >返<#=prizeGroupVal#>元</span>	<a data-param="action=del&id=<#=id#>" href="javascript:void(0);" title="删除" class="delete"></a> </li>',lotterysTextLength:40,addOrderDom:"#J-add-order"},o=e.Games,l=1,u=(Object.prototype.toString,function(e){for(var t,r=$.trim(e).split("&"),a=0,n=r.length,o={};n>a;a++)t=r[a].split("="),t.length>0&&(o[t[0]]=2==t.length?t[1]:"");return o}),m={init:function(e){var t=this,e=t.defConfig;t.cacheData={},t.cacheData.detailPostParameter={},t.orderData=[],o.setCurrentGameOrder(t),t.container=$(e.containerDom),t.containerEvent=$(e.containerEvent),t.totalLotterysNum=0,t.totalLotterysNumDom=$(e.totalLotterysNumDom),t.totalAmount=0,t.totalAmountDom=$(e.totalAmountDom),t.totalRebateDom=$(e.totalRebateDom),t.currentSelectId=0,t.eventProxy(),t.addEvent("afterAdd",function(){o.getCurrentGameTrace().getRowTableType();1==o.getCurrentGameTrace().getIsTrace()&&o.getCurrentGameTrace().autoDeleteTrace()}),t.addEvent("afterRemoveData",function(){o.getCurrentGameTrace().getRowTableType();1==o.getCurrentGameTrace().getIsTrace()&&o.getCurrentGameTrace().autoDeleteTrace()}),t.addEvent("afterResetData",function(){o.getCurrentGameTrace().getRowTableType();1==o.getCurrentGameTrace().getIsTrace()&&o.getCurrentGameTrace().autoDeleteTrace()}),o.getCurrentGameTypes().addEvent("endChange",function(){t.cancelSelectOrder()})},setTotalLotterysNum:function(e){var t=this,r=t.totalLotterysNum;t.totalLotterysNum=Number(e),t.totalLotterysNumDom.html(e),r!=t.totalLotterysNum&&t.fireEvent("afterChangeLotterysNum",t.totalLotterysNum)},setTotalAmount:function(e){var t=this,r=t.totalAmount;t.totalAmount=Number(e),t.totalAmountDom.html(t.formatMoney(e)),r!=t.totalAmount&&t.fireEvent("afterChangeAmout",t.totalAmount)},setTotalRebate:function(t){var r=this,a=r.totalRebate,t=t||0,n=Math.pow(10,6);if(t=""+parseFloat(t*n/n),t=t.split("."),t[1]){var o=""+t[1];o.length>6&&(o=o.slice(0,6)),str=e.util.formatMoney(t[0],0)+"."+o}else str=e.util.formatMoney(t[0],2);r.totalRebate=Number(str),r.totalRebateDom.html(str),a!=r.totalRebate&&r.fireEvent("afterChangeRebate",r.totalRebate)},addData:function(e){var t=this;t.orderData.unshift(e)},getOrderById:function(e){var t=this,e=Number(e),r=t.orderData,a=0,n=r.length;for(a=0;n>a;a++)if(Number(r[a].id)==e)return r[a]},removeData:function(e){for(var t=this,e=Number(e),r=t.orderData,a=0,n=r.length;n>a;a++)if(r[a].id==e){t.fireEvent("beforeRemoveData",r[a]),t.orderData.splice(a,1),t.updateData(),t.fireEvent("afterRemoveData");break}$("#gameorder-"+e).remove(),t.fireEvent("afterRemoveData")},reSet:function(){var e=this;return e.container.empty(),e.orderData=[],e.updateData(),e.fireEvent("afterResetData"),e},updateData:function(){var e=this,t=e.getTotal();e.setTotalLotterysNum(t.count),e.setTotalAmount(t.amount),e.setTotalRebate(t.rebate)},getTotal:function(){for(var e=this,t=e.orderData,r=0,a=t.length,n=0,o=0,i=0;a>r;r++)n+=t[r].num,o+=t[r].num*t[r].onePrice*t[r].moneyUnit*t[r].multiple,i+=Number(t[r].prizeGroupVal);return{count:n,amount:o,rebate:i,orders:t}},getOrderMaxMultiple:function(){for(var e,t,r,a,n,i,l=this,u=l.getTotal().orders,m=0,d=u.length,s=[],c="";d>m;m++){if(a=u[m].mid,n=u[m].multiple,e=o.getCurrentGame().getGameConfig().getInstance().getPrizeById(a),r=o.getCurrentGame().getGameConfig().getInstance().getMethodFullNameById(a),!e||!e.max_multiple)return c=o.getCurrentGame().getGameConfig().getInstance().getMethodCnFullNameById(a).join(""),void alert("["+c+"]\n玩法未配置奖金组中奖金额，投注倍数未能得到限制\n请配置该玩法相关配置");t=e.max_multiple,i=Number(t)<0?99999999:Number(t),s.push({gameMethod:r,maxnum:Math.floor(i/n)})}return s.sort(function(e,t){return e.maxnum-t.maxnum}),s.length>0?s[0]:{gameMethod:"",maxnum:1e8}},add:function(e){var t,r=this,a="",n=-1,i=r.defConfig.rowTemplate,u=0,m=o.getCurrentGameTrace().getIsTrace();if(r.fireEvent("beforeAdd",e),e.lotterys&&e.lotterys.length>0){if(r.currentSelectId>0)e.id=r.currentSelectId;else{if(n=r.checkData(e),-1!=n)return void o.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){r.addMultiple(e.multiple,e.prizeGroupVal,n),this.hide()},data:{tplData:{msg:"您选择的号码在号码篮已存在，将直接进行倍数累加"}}});e.id=l++}if(e.amountText=r.formatMoney(e.num*e.moneyUnit*e.multiple*e.onePrice),m&&("yingli"==o.getCurrentGameTrace().getRowTableType()||"yinglilv"==o.getCurrentGameTrace().getRowTableType()))for(u=0,t=r.orderData.length;t>u;u++)if(r.orderData[u].type!=e.type||r.orderData[u].moneyUnit!=e.moneyUnit)return void alert("盈利追号和盈利率追号不允许混投，\n 请确保玩法类型和元角模式一致");e.postParameter=o.getCurrentGame().getCurrentGameMethod().makePostParameter(e.original,e),e.oldMultiple=e.multiple,a=r.formatRow(i,r.rebuildData(e)),r.currentSelectId>0?r.replaceOrder(e.id,e):r.addData(e),r.currentSelectId>0?($(a).replaceAll($("#gameorder-"+r.currentSelectId)),r.cancelSelectOrder()):$(a).prependTo(r.container),o.getCurrentGame().getCurrentGameMethod().reSet(),o.getCurrentGameStatistics().reSet(),r.updateData(),r.fireEvent("afterAdd",e)}},replaceOrder:function(e,t){for(var r=this,a=r.orderData,n=0,o=a.length;o>n;n++)if(a[n].id==e)return void(a[n]=t)},render:function(){for(var e=this,t=e.getTotal().orders,r=0,a=t.length,n=[],o=e.defConfig.rowTemplate;a>r;r++)n[r]=e.formatRow(o,e.rebuildData(t[r]));e.updateData(),e.container.html(n.join(""))},rebuildData:function(e){var t=this,r=(t.defConfig,o.getCurrentGame().getGameConfig().getInstance()),a=r.getMethodCnFullNameById(e.mid);return typeText=r.getMethodCnFullNameById(e.mid).join(","),method=o.getCurrentGame().getCacheMethod(e.mid),a[0]==a[1]&&a[1]==a[2]&&(typeText=r.getMethodCnFullNameById(e.mid)[2]),e.typeText=typeText,e.lotterysText=method.formatViewBalls(e.original).substr(0,200),e.viewBalls=e.lotterysText,e.moneyUnitText=e.moneyUnitText||o.getCurrentGameStatistics().getMoneyUnitDom().getText(),e},formatRow:function(e,t){var r,a,n=t;for(r in n)n.hasOwnProperty(r)&&(a=RegExp("<#="+r+"#>","g"),e=e.replace(a,n[r]));return e},originalData:function(e){for(var t=this,r=[],a=0;a<e.length;a++)for(var n=0;n<e[a].length;n++)r[n]=r[n]||[],t.arrIndexOf(e[a][n],r[n])||r[n].push(e[a][n]);return r},arrIndexOf:function(e,t){for(var r,a=0;a<t.length;a++)t[a]==e&&(r=!0);return r||!1},checkData:function(e){var t,r,a,n=this,o=[],i=0;r=e.type,t=e.original,a=e.prizeGroup;for(var i=0;i<t.length;i++)o.push(t[i].join(""));return moneyUnit=e.moneyUnit,n.searchSameResult(r,o.join(),moneyUnit,a)},eventProxy:function(){var e=this,t=e.containerEvent;t.on("click",function(t){var r,a=t.target.getAttribute("data-param");a&&""!=$.trim(a)&&(r=u(a),$.isFunction(e["exeEvent_"+r.action])&&e["exeEvent_"+r.action].call(e,r,t.target))})},exeEvent_del:function(e){var t=this,r=Number(e.id);t.currentSelectId==r&&(o.getCurrentGame().getCurrentGameMethod().reSet(),t.cancelSelectOrder()),t.removeData(r)},exeEvent_detailhide:function(e,t){$(t).parents(".lottery-details-area").eq(0).hide()},exeEvent_detail:function(e,t){var r=this,t=$(t),a=Number(e.id),n=a,o=t.next(),i=o.find(".multiple"),l=o.find(".list"),u=r.getTotal().orders,m="";if(r.cacheData.currentDetailId&&$("#gameorder-"+r.cacheData.currentDetailId+" .lottery-details-area").hide(),r.cacheData.detailPostParameter[n])m=r.cacheData.detailPostParameter[n],r.cacheData.currentDetailId=n;else{for(var d=u.length-1;d>=0;d--)if(u[d].id==a){u=u[d];break}i.text("共 "+u.num+" 注"),m=u.postParameter,r.cacheData.currentDetailId=n,r.cacheData.detailPostParameter[n]=m,o.css({left:o.position().left+o.width()+5})}l.html(m),o.show()},exeEvent_reselect:function(e){var t=this,r=Number(e.id);t.selectOrderById(r)},updateDomStatus:function(){var e=this,t="button-game-edit",r=e.currentSelectId,a=$(e.defConfig.addOrderDom);r>0?a.addClass(t):a.removeClass(t)},selectOrderById:function(e){var t=this,r=t.getOrderById(e),a=r.original,n=(r.type,t.defConfig.selectedClass),i=$("#gameorder-"+e);-1==t.getOrderById(e).type.indexOf("danshi")&&(i.parent().children().removeClass(n),i.addClass(n),o.getCurrentGameTypes().changeMode(r.mid),o.getCurrentGameStatistics().getMultipleDom().setValue(r.multiple),o.getCurrentGameStatistics().triggerMoneyUnit(r.moneyUnit),o.getCurrentGameStatistics().setSliderValueByPrizeGroup(r.prizeGroup),o.getCurrentGame().getCurrentGameMethod().reSelect(a),t.currentSelectId=e,t.updateDomStatus())},cancelSelectOrder:function(){{var e=this,t=e.currentSelectId;$(e.defConfig.addOrderDom)}t>0&&($("#gameorder-"+t).removeClass(e.defConfig.selectedClass),e.currentSelectId=0,e.updateDomStatus(),o.getCurrentGame().getCurrentGameMethod().reSet())},formatMoney:function(e){var e=Number(e),t=/(-?\d+)(\d{3})/;for(e=Number.prototype.toFixed?e.toFixed(3):Math.round(100*e)/100,e=""+e;t.test(e);)e=e.replace(t,"$1,$2");return e},searchSameResult:function(e,t,r,a){for(var n,o=this,i=0,l=[],u=o.getTotal().orders;i<u.length;i++){l=[],n=u[i],ordersLotteryText=n.original;for(var m=0;m<ordersLotteryText.length;m++)l.push(ordersLotteryText[m].join(""));if(n.type==e&&t==l.join()&&n.moneyUnit==r&&a==n.prizeGroup)return i}return-1},addMultiple:function(e,t,r){var a=this,n=a.getTotal().orders,i=n[r],l=(i.type,i.mid),u=999999;if(1!=o.getCurrentGameTrace().getIsTrace()){if(u=o.getCurrentGame().getGameConfig().getInstance().getLimitByMethodId(l,i.moneyUnit),u=0>u?i.multiple+e:u,i.multiple+e>u)return void setTimeout(function(){o.getCurrentGameMessage().show({type:"normal",closeText:"确定",closeFun:function(){n[r].multiple=u,n[r].oldMultiple=n[r].multiple,n[r].amount=n[r].num*n[r].moneyUnit*n[r].multiple*n[r].onePrice,n[r].amountText=a.formatMoney(n[r].num*n[r].moneyUnit*n[r].multiple*n[r].onePrice),n[r].prizeGroupVal=Number(n[r].prizeGroupVal),a.render(),o.getCurrentGame().getCurrentGameMethod().reSet(),o.getCurrentGame().getCurrentGameMethod().ballsErrorTip(),o.getCurrentGameStatistics().reSet(),this.hide()},data:{tplData:{msg:"该组号码倍数已经超过最大限制("+u+"倍)，将调整为系统支持的最大倍数进行添加"}}})},100);n[r].multiple+=e,n[r].oldMultiple=n[r].multiple,n[r].amount=n[r].num*n[r].moneyUnit*n[r].multiple*n[r].onePrice,n[r].amountText=a.formatMoney(n[r].num*n[r].moneyUnit*n[r].multiple*n[r].onePrice),n[r].prizeGroupVal=Number(n[r].prizeGroupVal)+Number(t),a.render(),o.getCurrentGame().getCurrentGameMethod().reSet(),o.getCurrentGame().getCurrentGameMethod().ballsErrorTip(),o.getCurrentGameStatistics().reSet(),a.cancelSelectOrder()}},editMultiples:function(e){for(var t=this,r=t.getTotal().orders,a=0,n=r.length;n>a;a++)r[a].multiple=e,r[a].amount=r[a].num*r[a].moneyUnit*r[a].multiple*r[a].onePrice,r[a].amountText=t.formatMoney(r[a].amount);t.render(),t.cancelSelectOrder()},editMultiple:function(e,t){var r=this,a=r.getTotal().orders;a[t].multiple=e,a[t].amount=a[t].num*a[t].moneyUnit*a[t].multiple*a[t].onePrice,a[t].amountText=r.formatMoney(a[i].amount),r.render(),r.cancelSelectOrder()},restoreMultiples:function(){for(var e=this,t=e.getTotal().orders,r=0,a=t.length;a>r;r++)t[r].multiple=t[r].oldMultiple,t[r].amount=t[r].num*t[r].moneyUnit*t[r].multiple*t[r].onePrice,t[r].amountText=e.formatMoney(t[r].amount);e.render(),e.cancelSelectOrder()}},d=e.Class(m,r);d.defConfig=n,d.getInstance=function(e){return a||(a=new d(e))},e[t]=d}(dsgame,"GameOrder",dsgame.Event);