/*‮*/$(function(){var e=GAMECONFIG.name;betgame.Games[e].getInstance({jsNameSpace:"betgame.Games."+e+"."}),betgame.GameTypes.getInstance(),betgame.GameStatistics.getInstance(),betgame.GameOrder.getInstance(),betgame.GameTrace.getInstance(),betgame.GameSubmit.getInstance(),betgame.Games[e].Message.getInstance();var t,r,a=betgame.Games,n=a.getCurrentGame().getGameConfig().getInstance(),i=a.getCurrentGameMessage(),s=n.getCurrentGameNumber(),o=!0,u={issue:n.getCurrentGameNumber(),wn_number:n.getLotteryBalls()},d=new betgame.Tip({cls:"j-ui-tip-alert j-ui-tip-b j-ui-tip-showrule",text:"使用厘模式进行投注，单注注单最小金额为0.02元"}),m=$(".J-lottery-countdown"),g=$("#J-trace-statistics-countdown"),l=$("#J-header-currentNumber"),c=$("[data-lottery-ernie-numbers]"),C=$(".J-loading-lottery"),h=$("#J-ernie-issue"),f=GAMECONFIG.balls,G=GAMECONFIG.zeros?2:1,b=GAMECONFIG.timeout||15,p=function(e,t){e=""+parseInt(e),e=f.substr(0,f.length-e.length)+e,e=e.split(""),$("span",c).each(function(t){var r=e.substr(t*G,G);$(this).text(r)})},v={numberStep:p,easing:"easeInQuad"},w=GAMECONFIG.showLottery||function(e,t){h.html(e),t&&t.length?(c.show(),C.hide(),v.number=parseInt(t.join("")),c.animateNumber(v,2e3)):(c.hide(),C.show())},M=function(){for(var t=[],r=f.length/G,a="lottery-"+e.toLowerCase();r--;){var n=G>1?"0"+r:r;t.push("<span>"+n+"</span>")}return c.html(t.join("")).addClass(a)},y=function(){o&&(s=n.getLastGameNumber(),o=!1),$.ajax({url:n.getLoadIssueUrl(),dataType:"JSON",success:function(e){var a=e.issues,n=a[0];r=a,n.issue==u.issue&&n.wn_number==u.wn_number||(u.issue=n.issue,u.wn_number=n.wn_number,n.wn_number?(t.stop(),w(n.issue,n.wn_number.split(""))):w(n.issue))}})},T=function(){var e,r=n.getCurrentLastTime(),s=n.getCurrentTime(),o=r-s,u=""+n.getCurrentGameNumber(),d=b;e=function(){if(o<0||d<0)return t&&t.stop&&t.stop(),a.getCurrentGame().getServerDynamicConfig(function(){var e,t=""+n.getCurrentGameNumber(),r=3;i.hide(),a.getCurrentGameTrace().autoDeleteTrace(),a.getCurrentGameTrace().hide(),u!=t&&(i.showTip('<div class="tipdom-cont"><p class="row">当前已进入第<big class="row c-highlight">'+t+' 期</big></p><p class="row">请留意期号变化 (<big data-tip-second-left class="c-highlight">'+r+"</big>)</p></div>"),e=setInterval(function(){r-=1,$("[data-tip-second-left]").text(r),r<=0&&(clearInterval(e),i.hideTip())},1e3))}),void(d=b);var e="",r=Math.floor(o/3600),s=Math.floor(o%3600/60),l=o%3600%60;r=r<10?"0"+r:""+r,s=s<10?"0"+s:""+s,l=l<10?"0"+l:""+l,e=r+":"+s+":"+l,m.find("[data-hour]").html(r).end().find("[data-minute]").html(s).end().find("[data-second]").html(l),g.html(e),o--,d--},t=new betgame.Timer({time:1e3,fn:e}),l.html(u)};M(),T(),$("body").addClass("game-page-"+e.toLowerCase()),a.getCurrentGame().addEvent("changeDynamicConfig",function(e,r){t=new betgame.Timer({time:5e3,isNew:!0,fn:y}),T()}),a.getCurrentGameTypes().addEvent("beforeChange",function(e,t){var r,a=$("#J-panel-gameTypes li"),i=$("#J-gametyes-menu-panel"),s=i.find('[data-id="'+t+'"]'),o=(n.getMethodCnNameById(t),"current");s.size()>0&&(i.find("dd").removeClass(o).end(),s.addClass(o),r=s.parents("li").addClass("current").show(),a.removeClass("current").eq(r.index()).addClass("current"))});var S=new betgame.Tip({cls:"j-ui-tip-b j-ui-tip-showrule"});$("#J-balls-main-panel").on("mouseover",".pick-rule, .win-info",function(){var e=$(this),t=a.getCurrentGame().getCurrentGameMethod().getId(),r=n.getMethodById(t),i=e.hasClass("pick-rule")?r.bet_note:r.bonus_note;S.setText(i),S.show(S.getDom().width()/2*-1+e.width()/2,S.getDom().height()*-1-20,e)}),$("#J-balls-main-panel").on("mouseleave",".pick-rule, .win-info",function(){S.hide()}),$("#J-balls-main-panel").on("click",".pick-rule, .win-info",function(){return!1});var J=0;a.getCurrentGame().addEvent("afterSwitchGameMethod",function(e,t){var t=a.getCurrentGame().getCurrentGameMethod().getId(),r=a.getCurrentGameStatistics().getMoneyUnit(),i=n.getLimitByMethodId(t,r),s=n.getPrizeById(t),o=n.getMaxPrizeGroup(),u=n.getOptionalPrizes().length,d=n.getOptionalPrizes()[u-1].prize_group,m=0,g=!1;if(J=Number(s.prize),g=s.display_prize,m=d>o?J*r*o/d:J*r,a.getCurrentGameStatistics().getMultipleDom().setMaxValue(i),g?($("#J-method-prize").show(),$("#J-method-prize").find("span").html(betgame.util.formatMoney(m))):$("#J-method-prize").hide(),GAMECONFIG.hasRenxuan){if(a.getCurrentGame().getCurrentGameMethod().defConfig.digitConf){var l=a.getCurrentGame().getCurrentGameMethod().defConfig,c=l.digitNeed||0,C=l.digitConf;a.getCurrentGame().initDigitStatus(c,C)}else a.getCurrentGameStatistics().setProjectNum(1),a.getCurrentGameStatistics().setDigitChoose([]);if(a.getCurrentGame().getCurrentGameMethod().defConfig.orderSplitType){var h=a.getCurrentGame().getCurrentGameMethod().defConfig.orderSplitType;a.getCurrentGame().getCurrentGameMethod().setOrderSplitType(h)}else a.getCurrentGame().getCurrentGameMethod().setOrderSplitType("")}}),a.getCurrentGameTypes().addEvent("endShow",function(){this.changeMode(n.getDefaultMethodId())}),$("#J-add-order").on("click",function(){var e=a.getCurrentGameStatistics().getResultData();!e.mid||e.amount<"0.02"||a.getCurrentGameOrder().add(e)}),$("#J-fast-submit").on("click",function(){a.getCurrentGame().getCurrentGameMethod().filterOrder&&(a.getCurrentGame().getCurrentGameMethod().filterOrder("hide"),a.getCurrentGame().getCurrentGameMethod().updateData());var e=a.getCurrentGameStatistics().getResultData();!e.mid||e.amount<"0.02"||a.getCurrentGameOrder().fastOrder(e)}),a.getCurrentGameStatistics().addEvent("afterUpdate",function(e,t,r){var a=this,i=$("#J-add-order"),s=$("#J-fast-submit"),o=n.getMaxPrizeGroup(),u=n.getOptionalPrizes().length,m=n.getOptionalPrizes()[u-1].prize_group;if(t>0)if(r>="0.02"){i.add(s).removeClass("btn-disable");var g=a.getPrizeGroupRate()||0;a.setRebate(r,g),d.hide()}else d.show(-s.parent().width()/2,d.getDom().height()*-1-20,s),i.add(s).addClass("btn-disable"),a.setRebate(0);else i.add(s).addClass("btn-disable"),a.setRebate(0),d.hide();var l=J*Number(a.getMoneyUnit());m>o&&(l=J*Number(a.getMoneyUnit())*o/m),$("#J-method-prize").find("span").html(betgame.util.formatMoney(l))});var I,O=$("#J-panel-order-list-cont");O.jScrollPane(),I=O.data("jsp"),a.getCurrentGameOrder().addEvent("afterChangeLotterysNum",function(e,t){var r=$("#J-submit-order"),a=$("#J-trace-switch"),n=e.data.orderData,i=!1,s=$(".J-cart-empty");if(t>0){for(var o=0;o<n.length;o++).001==n[o].moneyUnit?i=!0:"";i?(r.removeClass("btn-bet-disable"),a.addClass("btn-bet-disable")):r.add(a).removeClass("btn-bet-disable"),s.hide(),I.reinitialise()}else r.add(a).addClass("btn-bet-disable"),s.show()}),$("body").on("click",".remove-error",function(){a.getCurrentGame().getCurrentGameMethod().removeOrderError()}).on("click",".remove-same",function(){a.getCurrentGame().getCurrentGameMethod().removeOrderSame()}).on("click",".filter-order",function(){a.getCurrentGame().getCurrentGameMethod().filterOrder()}).on("click",".remove-all",function(){a.getCurrentGame().getCurrentGameMethod().removeOrderAll()}),a.getCurrentGameStatistics().setMultiple(n.getDefaultMultiple()),a.getCurrentGameStatistics().setMoneyUnitDom(n.getDefaultCoefficient()),$("body").on("click","#J-submit-order",function(){a.getCurrentGameTrace().deleteTrace(),a.getCurrentGameSubmit().submitData()}),$("#J-trace-switch").on("click",function(){for(var e=a.getCurrentGameOrder().orderData,t=!1,r=0;r<e.length;r++)"0.001"==e[r].moneyUnit?t=!0:"";return!t&&($("#J-trace-statistics-balance").html($("[data-user-account-balance]").html()),a.getCurrentGameTrace().show(),!1)}),$("#J-trace-panel").on("click",".closeBtn",function(){a.getCurrentGameTrace().hide(),a.getCurrentGameTrace().deleteTrace()}),$("#J-button-trace-confirm").on("click",function(){a.getCurrentGameTrace().getIsTrace()&&(a.getCurrentGameTrace().hide(),a.getCurrentGameSubmit().submitData(),a.getCurrentGameTrace().deleteTrace())}),a.getCurrentGameSubmit().addEvent("beforeSend",function(e,t){var r=t.win.dom.find(".pop-control"),a=r.find("a.confirm");r.find("a.cancel");a.addClass("btn-disabled"),a.text("提交中..."),t.win.hideCancelButton()}),a.getCurrentGameSubmit().addEvent("afterSubmit",function(e,t){var r=t.win.dom.find(".pop-control"),a=r.find("a.confirm");r.find("a.cancel");a.removeClass("btn-disabled"),a.text("确 认"),$("[data-refresh-balance]:eq(0)").trigger("click")}),GAMECONFIG.hasRenxuan&&($("body").on("click","[digit-status]",function(e){var t=$(this).parent().index();if(!a.getCurrentGame().digitStatusToggle(t))return!1}),a.getCurrentGame().addEvent("afterDigitStatusChange",function(e,t){$(".J-digit-num-choosed").text(a.getCurrentGame().getDigitChoosed().length),$(".J-digit-project-num").text(a.getCurrentGame().getProjectNum())}),a.getCurrentGame().addEvent("digitLabelsEvent",function(e,t){var r=$("[digit-status]",a.getCurrentGame().getCurrentGameMethod().container);r.eq(e).length&&r.eq(e).prop("checked",t)}),a.getCurrentGameTypes().addEvent("afterGametypesChange",function(e,t){var r=$(t),a="renxuan-is-visible";r.hasClass(a)?r.removeClass(a).text("任选玩法").siblings().show().filter(".gametypes-menu-renxuan").hide():r.addClass(a).text("普通玩法").siblings().hide().filter(".gametypes-menu-renxuan").show()}))});